# Telegram Bot для преподавателей

Бот для автоматизации учета занятий преподавателей через Google Таблицы.

## Функциональность

✅ **Полная регистрация преподавателей:**
- ФИО полностью
- Номер телефона
- Предмет преподавания
- Выбор классов (начальные, средние, старшие)

✅ **Автоматическое создание персональных вкладок:**
- Копирование шаблона для каждого преподавателя
- Уникальные названия вкладок по ФИО

✅ **Обработка занятий:**
- Автоматическое добавление записей по ФИО ученика
- Поддержка примечаний через символ "/"
- Проверка существующих записей за текущую дату
- Автоматическое добавление отметок "да" о проведении занятия

✅ **Безопасность:**
- Работа только в закрытом чате
- Идентификация по Telegram ID

## Установка и настройка

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Настройка переменных окружения
Создайте файл `.env` в корне проекта:
```env
BOT_TOKEN=your_telegram_bot_token
AUTHORIZED_CHAT_ID=your_chat_id
GOOGLE_CREDENTIALS_JSON=path/to/your/service-account.json
SPREADSHEET_ID=your_google_spreadsheet_id
```

### 3. Настройка Google Sheets API
1. Создайте проект в Google Cloud Console
2. Включите Google Sheets API
3. Создайте сервис-аккаунт и скачайте JSON-файл
4. Предоставьте доступ к таблице для email сервис-аккаунта

### 4. Подготовка Google Таблицы
1. Создайте таблицу с ID из переменной окружения
2. Создайте лист "Преподаватели" с колонками:
   - ФИО
   - Номер телефона
   - Telegram ID
   - Username
   - Предмет
   - Классы
   - Дата регистрации
3. Создайте лист "Шаблон" со структурой:
   - A1: "Преподаватель:" (желтый фон)
   - A2: "Номер телефона:" (желтый фон)
   - B1, B2: пустые ячейки для заполнения ФИО и телефона
   - Строка 5: заголовки таблицы (Ученик/класс, Контакты, Почта, Стоимость, и т.д.)
   - Строка 6: даты недели (Пн, вт, ср, чт, пт, сб, вс)
   - Строка 7: конкретные даты в формате DD.MM.YYYY
   - Даты продлены до конца года

### 5. Получение Chat ID
Запустите `get_chat_id.py` и отправьте сообщение в нужный чат:
```bash
python get_chat_id.py
```

## Использование

### Запуск бота
```bash
python bot.py
```

### Регистрация преподавателя
При первом сообщении бот автоматически запустит процесс регистрации:
1. Ввод ФИО полностью
2. Ввод номера телефона
3. Ввод предмета преподавания
4. Выбор классов (кнопки)

### Запись занятий
После регистрации преподаватели могут отправлять сообщения в формате:
- `Петров Петр 5` - базовый формат
- `Иванова Анна 7 / хорошо подготовилась` - с примечанием
- `Сидоров Иван / пропустил занятие` - без указания класса

## Структура проекта

```
Specialists_bot/
├── bot.py              # Основной файл бота
├── config.py           # Конфигурация
├── registration.py     # Логика регистрации
├── lessons.py          # Обработка занятий
├── google_sheets.py    # Работа с Google Таблицами
├── get_chat_id.py      # Утилита для получения Chat ID
├── requirements.txt    # Зависимости
├── README.md          # Документация
└── .env               # Переменные окружения (создать)
```

## Команды бота

- `/start` - Начать работу с ботом
- `/cancel` - Отменить регистрацию

## Обработка ошибок

Бот включает обработку следующих ошибок:
- Неверный формат сообщения
- Ошибки подключения к Google Sheets
- Отсутствие регистрации
- Некорректные данные

## Логирование

Все ошибки и важные события логируются в консоль для отладки. 